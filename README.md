# multimixer-128
Multimixer-128: Universal Keyed Hashing Based on Integer Multiplication

## Overview

$Multimixer_{128}$ is a universal keyed hashing algorithm, based on just integer arithmetic ( addition and multiplication ), proposed in paper https://ia.cr/2023/1357. 

A keyed hash function, takes a key and a variable length message as input, compressing it to a fixed length digest. The keyed hashing scheme proposed in $Multimixer_{128}$ paper, takes equal length key and message ( meaning long keys will be required, in case message is long ) s.t. they are multiple of block size ( = 32 -bytes ) and compresses them into a 64 -bytes digest. It's proved to be an ε-∆universal hash function with ε = $2^{−127}$. It can be used during the compression phase of a message authentication code computation scheme. It can also be used in the compression phase of the Farfalle construction - which are used for building deck functions.

As $Multimixer_{128}$ is just based on integer arithmetic, which is pretty fast on most processors, it shows quite promising results during benchmarks. See [below](#benchmarking).

You can also find more details on how to start using $Multimixer_{128}$ API, [below](#usage).

## Prerequisites

Rust stable toolchain; see https://rustup.rs for installation guide.

```bash
# When developing this library, I was using
$ rustc --version
rustc 1.73.0 (cc66ad468 2023-10-03)
```

## Testing

For ensuring functional correctness and conformance to the specification of $Multimixer_{128}$ i.e. https://ia.cr/2023/1357 ( and its reference implementation https://github.com/Parisaa/Multimixer ), I use known answer tests that I've generated by following instructions described in https://gist.github.com/itzmeanjan/a32eab0244af55eba2847c6472337535.

```bash
cargo test --lib
```

## Benchmarking

Issue following command for benchmarking public function $f_{128}$ and $Multimixer_{128}$, with variable ( non-zero multiple of 32 -bytes ) length input key and message, on target CPU.

> **Note**
When benchmarking on `x86`, `x86_64`, `loongarch64` targets, CPU cycles and cycles/ byte metrics are reported, using `rdtsc` instruction, though for other targets, default wallclock timer of criterion.rs is used for reporting time and throughput. I found https://github.com/pornin/crrl/blob/73b33c1efc73d637f3084d197353991a22c10366/benches/util.rs pretty useful for obtaining CPU cycles when benchmarking Rust functions. But I'm using criterion.rs as benchmark harness, hence I decided to go with https://crates.io/crates/criterion-cycles-per-byte plugin, much easier to integrate.

```bash
RUSTFLAGS="-C opt-level=3 -C target-cpu=native" cargo bench --features="internal"
```

### On 12th Gen Intel(R) Core(TM) i7-1260P

```bash
f_128/f-128 (cached)    time:   [8.0854 cycles 8.1049 cycles 8.1252 cycles]
                        thrpt:  [0.2539 cpb 0.2533 cpb 0.2527 cpb]
Found 4 outliers among 100 measurements (4.00%)
  2 (2.00%) low severe
  2 (2.00%) low mild
f_128/f-128 (random)    time:   [21.6965 cycles 21.8242 cycles 21.9344 cycles]
                        thrpt:  [0.6855 cpb 0.6820 cpb 0.6780 cpb]

multimixer_128/32 (cached)
                        time:   [14.9805 cycles 15.0239 cycles 15.0683 cycles]
                        thrpt:  [0.2354 cpb 0.2347 cpb 0.2341 cpb]
Found 4 outliers among 100 measurements (4.00%)
  2 (2.00%) low mild
  1 (1.00%) high mild
  1 (1.00%) high severe
multimixer_128/32 (random)
                        time:   [74.6846 cycles 75.5183 cycles 76.5033 cycles]
                        thrpt:  [1.1954 cpb 1.1800 cpb 1.1669 cpb]
Found 6 outliers among 100 measurements (6.00%)
  1 (1.00%) low severe
  4 (4.00%) high mild
  1 (1.00%) high severe

multimixer_128/64 (cached)
                        time:   [24.6028 cycles 24.6415 cycles 24.6819 cycles]
                        thrpt:  [0.1928 cpb 0.1925 cpb 0.1922 cpb]
Found 5 outliers among 100 measurements (5.00%)
  1 (1.00%) low mild
  3 (3.00%) high mild
  1 (1.00%) high severe
multimixer_128/64 (random)
                        time:   [86.8100 cycles 87.4062 cycles 88.0316 cycles]
                        thrpt:  [0.6877 cpb 0.6829 cpb 0.6782 cpb]
Found 7 outliers among 100 measurements (7.00%)
  1 (1.00%) low severe
  6 (6.00%) low mild

multimixer_128/128 (cached)
                        time:   [42.4531 cycles 42.5529 cycles 42.6533 cycles]
                        thrpt:  [0.1666 cpb 0.1662 cpb 0.1658 cpb]
Found 4 outliers among 100 measurements (4.00%)
  4 (4.00%) high mild
multimixer_128/128 (random)
                        time:   [117.9426 cycles 119.1114 cycles 120.4269 cycles]
                        thrpt:  [0.4704 cpb 0.4653 cpb 0.4607 cpb]
Found 5 outliers among 100 measurements (5.00%)
  5 (5.00%) low mild

multimixer_128/256 (cached)
                        time:   [83.8926 cycles 84.0747 cycles 84.2476 cycles]
                        thrpt:  [0.1645 cpb 0.1642 cpb 0.1639 cpb]
multimixer_128/256 (random)
                        time:   [163.5131 cycles 164.1794 cycles 164.9104 cycles]
                        thrpt:  [0.3221 cpb 0.3207 cpb 0.3194 cpb]
Found 4 outliers among 100 measurements (4.00%)
  2 (2.00%) low severe
  2 (2.00%) low mild

multimixer_128/512 (cached)
                        time:   [165.7976 cycles 166.0641 cycles 166.3238 cycles]
                        thrpt:  [0.1624 cpb 0.1622 cpb 0.1619 cpb]
Found 7 outliers among 100 measurements (7.00%)
  1 (1.00%) low mild
  5 (5.00%) high mild
  1 (1.00%) high severe
multimixer_128/512 (random)
                        time:   [268.4880 cycles 269.9241 cycles 271.4020 cycles]
                        thrpt:  [0.2650 cpb 0.2636 cpb 0.2622 cpb]
Found 1 outliers among 100 measurements (1.00%)
  1 (1.00%) high mild

multimixer_128/1024 (cached)
                        time:   [319.1888 cycles 319.5246 cycles 319.8942 cycles]
                        thrpt:  [0.1562 cpb 0.1560 cpb 0.1559 cpb]
Found 9 outliers among 100 measurements (9.00%)
  5 (5.00%) high mild
  4 (4.00%) high severe
multimixer_128/1024 (random)
                        time:   [461.6959 cycles 465.0396 cycles 468.2226 cycles]
                        thrpt:  [0.2286 cpb 0.2271 cpb 0.2254 cpb]

multimixer_128/2048 (cached)
                        time:   [609.2881 cycles 609.7706 cycles 610.2736 cycles]
                        thrpt:  [0.1490 cpb 0.1489 cpb 0.1488 cpb]
Found 6 outliers among 100 measurements (6.00%)
  3 (3.00%) high mild
  3 (3.00%) high severe
multimixer_128/2048 (random)
                        time:   [848.1066 cycles 858.2579 cycles 867.1351 cycles]
                        thrpt:  [0.2117 cpb 0.2095 cpb 0.2071 cpb]

multimixer_128/4096 (cached)
                        time:   [1189.4965 cycles 1190.0296 cycles 1190.6192 cycles]
                        thrpt:  [0.1453 cpb 0.1453 cpb 0.1452 cpb]
Found 8 outliers among 100 measurements (8.00%)
  5 (5.00%) high mild
  3 (3.00%) high severe
multimixer_128/4096 (random)
                        time:   [1541.4178 cycles 1557.3923 cycles 1570.5377 cycles]
                        thrpt:  [0.1917 cpb 0.1901 cpb 0.1882 cpb]
```

## Usage

Using $Multimixer_{128}$ hasher API is pretty straight-forward.

1) Add `multimixer-128` to Cargo.toml, as your project dependency.

```toml
[dependencies]
multimixer-128 = { git = "https://github.com/itzmeanjan/multimixer-128" }
```

2) Get non-zero, equal length key and message s.t. their byte length is a multiple of block size (= 32 -bytes), as input.

```rust
use multimixer_128;

fn main() {
    const BLOCKS: usize = 1;
    const MLEN: usize = multimixer_128::BLOCK_SIZE * BLOCKS;

    // Beware, this is just an example key !
    let key = [0x0fu8; MLEN];
    let msg = [0xf0u8; MLEN];
    let mut dig = [0u8; multimixer_128::DIGEST_SIZE];

    // ...
}
```

3) Compute 64 -bytes message digest.

```rust
fn main() {
    // ...

    multimixer_128::multimixer_128(&key, &msg, &mut dig);
    assert_eq!(dig, [1, 0, 0, 0, 254, 255, 255, 255, 1, 0, 0, 0, 254, 255, 255, 255, 1, 0, 0, 0, 254, 255, 255, 255, 1, 0, 0, 0, 254, 255, 255, 255, 9, 0, 0, 0, 250, 255, 255, 255, 9, 0, 0, 0, 250, 255, 255, 255, 9, 0, 0, 0, 250, 255, 255, 255, 9, 0, 0, 0, 250, 255, 255, 255]);
}
```

I'm maintaining an example program, demonstrating usage of $Multimixer_{128}$ API, living inside [examples](./examples/) directory.

```bash
cargo run --example multimixer_128

Key     = e02f28d290bd51df3b103396debe7f2ffc90b837588e37b13a7cc8cccce9fa11
Message = 1511ad54daae3df6706e33d9953f5dff4eabb2da85ad1added1aba2e0b571397
Digest  = d2324595d842cb028205c1f00328ba760d292a690452726d95728070ee7ff21e8e6af14b1e4c6d15404e709fd1fec952da3e3b7b3fe7d038fca793f3b4d7661a
```
